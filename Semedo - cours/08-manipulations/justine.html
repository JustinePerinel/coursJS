<!doctype html>
<html lang="fr">
  <head>
    <title>Formulaire</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        .error {
            border: 1px solid red;
        }
        .valid {
            border: 1px solid green;
        }
    </style>
  </head>
  <body>
        <div class="jumbotron">
            <h1 class="display-3"><a href="../index.html">Retour vers l'index</a></h1>
            <p class="lead">VIII 04 - Formulaire</p>
            <hr class="my-2">
            <p>Du JavaScript avec un formulaire. </p>
        </div> <!-- fin jumbotron -->
        <div class="container">
            <div class="row border border-dark my-4 p-2">
                <div class="col-12 p-3">
                    <h2 class="text-center">Fonction controleForm()</h2>
                </div>
                <div class="col-6 p-3">
                    <form action="formulaire.php" method="GET" name="formulaire" class="form">
                       <div class="form-group">
                            <label for="pseudo" class="sr-only">Pseudoyme</label>
                            <input type="text" name="pseudo" id="pseudo" placeholder="Votre pseudo" class="form-control">
                       </div>
                        <div class="form-group">
                            <label for="mdp" class="sr-only">Mot de passe</label>
                            <input type="password" name="mdp" id="mdp" placeholder="Mot de passe" class="form-control">
                        </div>
                        <button type="submit" id="submit" value="ok" class="btn btn-primary" onclick="controleForm()">Envoyer</button>
                    </form>
                </div>
                <div class="col-6 p-3">
                    <p>On voit ici de nouvelles classes Bootstrap :</p>
                    <ul>
                        <li><code>form-inline</code> permet d'avoir le formulaire sur la même ligne.</li>
                        <li><code>form-group</code> entoure des éléments label et input d'un formulaire qui vont ensemble.</li>
                        <li><code>form-control</code> permet de styler les inputs grâce à Bootstrap.</li>
                        <li><code>sr-only</code> permet de cacher l'intitulé du label (toujours le mettre !)</li>
                    </ul>
                </div>
            </div>
            <div class="row border border-dark my-4 p-2">
                <div class="col-12">
                    <h2>Nouvelle fonction : inscriptionForm()</h2>
                </div>
                <div class="col-3 p-3">
                    <p>Des explications</p>
                </div>
                <div class="col-9 p-3">
                    <form action="inscription2" method="GET" name="inscription" id="form_inscription">
                        <div class="form-goup my-2">
                            <label for="prenom" class="sr-only">Prénom</label>
                            <input type="text" name="prenom" id="prenom" class="form-control" placeholder="Prénom">
                        </div>
                        <div class="form-gou my-2p">
                            <label for="nom" class="sr-only">Prénom</label>
                            <input type="text" name="nom" id="nom" class="form-control" placeholder="Nom de famille">
                        </div>
                        <div class="form-goup my-2">
                            <label for="email" class="sr-only">Email</label>
                            <input type="email" name="email" id="email" class="form-control" placeholder="Votre e-mail">
                        </div>
                        <div class="form-goup my-2">
                            <label for="mdp_2" class="sr-only">Mot de passe</label>
                            <input type="password" name="mdp_2" id="mdp_2" class="form-control" placeholder="Votre mot de passe">
                        </div>
                        <div class="form-goup my-2">
                            <label for="confmdp" class="sr-only">Mot de passe</label>
                            <input type="password" name="confmdp" id="confmdp" class="form-control" placeholder="Confirmez votre mot de passe">
                        </div>
                        <button type="submit" id="submit_2" value="inscription" class="btn btn-primary">S'inscrire</button>
                        <!-- <button type="reset" class="btn btn-warning">Effacer</button> -->
                        <button id="reset_form" class="btn btn-warning">Effacer</button>
                    </form>
                </div>
            </div>
        </div><!-- fin container -->
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- mes scripts -->
    <script>
        // contrôles du formulaire avec une fonction
        function controleForm(){
            if (document.formulaire.pseudo.value.length < 5 || document.formulaire.pseudo.value.length > 15) {
                event.preventDefault();
                console.log(document.formulaire.pseudo.value);
                alert('Votre pseudo doit comporter entre 5 et 15 caractères.');
            }
            if (document.formulaire.mdp.value.length < 8 || document.formulaire.mdp.value.length > 12) {
                console.log(document.formulaire.mdp.value);
                alert('le mot de passe doit comporter entre 8 et 12 caractères. ')
            }
        }
        //2e fonction
        // contrôle du formulaire d'inscription avec la fonction
        let formInscrip = document.getElementById('form_inscription');
        // récupération du formulaire par son id
        formInscrip.addEventListener('submit', inscriptionForm);
        // écoute l'envoie du formulaire (avec Touche Entrée du coup ou submit)
        //fonction pour traiter le formulaire
        function inscriptionForm(event){ //ou e pour event. A harmoniser avec e.preventDefault() 
            event.preventDefault(); // utiliser e si il est en argument de la fonction. Sinon, event.
            // console.log(event.target.prenom);
            let regex = /([a-z0-9](\.?|\_|\-))*@([a-z0-9]{2,})(\.[a-z]{2,}){1,}/;
            // let regex = new RegExp('([a-z0-9](\.?|\_|\-))*@([a-z0-9]{2,})(\.[a-z]{2,}){1,}');
            // récupération du contenu des champs dans des variables
            let prenom  = event.target.prenom.value,
                nom     = event.target.nom.value,
                email   = event.target.email.value,
                mdp_2   = event.target.mdp_2.value,
                confmdp = event.target.confmdp.value;
            console.log(prenom, nom, email, mdp_2, confmdp);
            if ( prenom !== ''|| nom !== ''){ // on vérifie qu'il n'y a pas d'input vide
                if (prenom.length < 2){
                    event.target.prenom.classList.remove('valid')
                    event.target.prenom.classList.add('error');
                }else {
                    // on enleve la classe error avant de lui assigner la classe valid
                    event.target.prenom.classList.remove('error');
                    event.target.prenom.classList.add('valid');
                }
                if (nom.length < 2){
                    event.target.nom.classList.remove('valid')
                    event.target.nom.classList.add('error'); 
                } else {
                    event.target.nom.classList.remove('error');
                    event.target.nom.classList.add('valid');
                }
            }
            if (mdp_2.length > 6 && mdp_2.length <= 12) {
                event.target.mdp_2.classList.remove('error');
                event.target.mdp_2.classList.add('valid');
            }else {
                event.target.mdp_2.classList.remove('valid');
                event.target.mdp_2.classList.add('error');
            }
            if (confmdp !== mdp_2) {
                event.target.confmdp.classList.remove('valid')
                event.target.confmdp.classList.add('error');
            }else {
                event.target.confmdp.classList.remove('error');
                event.target.confmdp.classList.add('valid');
            }
            //console.log(regex.test(email));
            if(regex.test(email) === false){
                event.target.email.classList.add('error');
                event.target.email.classList.remove('error');
            }
        } // fin fonction
        // document.getElementsById('reset_form').addEventListener('click', (e) => { // fonction flêchée anonyme
        //     console.log(e.target.form);
        //     event.target.form.prenom.value = '';
        //     event.target.form.nom.value = '';
        //     event.target.form.email.value = '';
        //     event.target.form.mdp_2.value = '';
        //     event.target.form.confmdp.value = '';
        //     //permet de vider tous les champs du formulaire
        // });
    </script>
  </body>
</html>